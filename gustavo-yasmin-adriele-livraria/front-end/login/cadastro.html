<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cadastro - Livraria Web</title>
  <link rel="stylesheet" href="./login.css" />
</head>

<body>
  <div class="login-container">
    <h2>Cadastre-se</h2>
    <form action="./cadastro.php" method="post">
      <label for="nome">Nome Completo:</label>
      <input type="text" id="nome" name="nome" required />

      <label for="email">E-mail:</label>
      <input type="email" id="email" name="email" required />

      <label for="senha">Senha:</label>
      <input type="password" id="senha" name="senha" required minlength="6" />

      <label for="confirmaSenha">Confirme a Senha:</label>
      <input type="password" id="confirmaSenha" name="confirmaSenha" required minlength="6" />

      <button id="btn-cadastrar" type="submit">Cadastrar</button>
      <p class="link-cadastro">
        Já tem conta? <a href="login.html">Entrar aqui</a>
      </p>
    </form>
  </div>

  <script>
  const form = document.querySelector("form");
  const btnCadastrar = document.querySelector("#btn-cadastrar");

  // Função para validar senhas iguais
  form.addEventListener("submit", (e) => {
    const senha = document.getElementById("senha").value;
    const confirmaSenha = document.getElementById("confirmaSenha").value;

    if (senha !== confirmaSenha) {
      e.preventDefault();
      alert("As senhas não coincidem!");
    }
  });

  // Função que pega a data atual formatada (aaaa-mm-dd)
  function dataCadastro() {
    const dataAtual = new Date();
    const dia = String(dataAtual.getDate()).padStart(2, "0");
    const mes = String(dataAtual.getMonth() + 1).padStart(2, "0");
    const ano = dataAtual.getFullYear();
    return `${ano}-${mes}-${dia}`;
  }

  // Quando clicar no botão "Cadastrar"
  btnCadastrar.addEventListener("click", async (event) => {
    event.preventDefault(); // impede o formulário de recarregar a página

    const formData = new FormData(form);
    const usuario = {
      nome: formData.get("nome"),
      email: formData.get("email"),
      senha: formData.get("senha"),
      data_cadastro: dataCadastro(),
    };

    console.log("Enviando usuário:", usuario);

    try {
      const resposta = await fetch("http://localhost:3000/cadastrarusuario", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify(usuario),
      });

      const dados = await resposta.json();
      alert(dados.mensagem || "Usuário cadastrado com sucesso!");
    } catch (erro) {
      console.error("Erro ao cadastrar:", erro);
      alert("Erro ao cadastrar usuário. Verifique o servidor!");
    }
  });
</script>

</body>

</html>